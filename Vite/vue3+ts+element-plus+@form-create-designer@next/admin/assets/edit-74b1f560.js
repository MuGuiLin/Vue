import{d as S,q as F,l as z,h as f,r as V,j,s as E,c as k,w as o,a as n,o as d,b as l,v as L,e as i,t as T,x as D,y as w,F as N,u as H,z as J,A as K,$ as O,_ as Q}from"./index-a89cdc83.js";import{e as W}from"./department-b2669846.js";const X=S({__name:"edit",setup(Y){const{query:h}=F(),b=z(),p=f(),m=f(!1),x=[{value:"0",label:"冻结"},{value:"1",label:"正常"}],t=V({id:h.id||"",depID:"",state:"1",usrName:"",usrPhone:"",usrMail:""}),v=f([]),I=V({usrName:[{required:!0,message:"对不起：请输入姓名！",trigger:"blur"}],usrPhone:[{required:!0,message:"对不起：请输入手机号！",trigger:"blur"},{min:11,max:11,message:"对不起：请正确输入手机号！",trigger:"blur"}]}),C=async()=>{try{m.value=!0;const{message:s}=t.id?await J(t):await K(t);O({showClose:!0,message:s,type:"success",onClose:b.back})}catch(s){throw new Error(`API请求出错：${s}`)}finally{m.value=!1}},M=s=>{s&&s.resetFields()},P=s=>{s&&s.validate(async e=>{e&&C()})};return j(async()=>{const{data:s}=await W(t);if(s.length&&(v.value=s),t.id)try{const{data:e}=await E({usrID:t.id});t.depID=e.depID,t.state=e.state,t.usrName=e.usrName,t.usrPhone=e.usrPhone,t.usrMail=e.usrMail}catch(e){console.error(e)}}),(s,e)=>{const A=n("Guide"),r=n("el-icon"),c=n("el-input"),u=n("el-form-item"),y=n("el-option"),g=n("el-select"),B=n("Back"),_=n("el-button"),R=n("Select"),$=n("Refresh"),U=n("el-form"),q=n("el-card"),G=n("el-main");return d(),k(G,{class:"user-edit"},{default:o(()=>[l(q,null,{header:o(()=>[L("h4",null,[l(r,null,{default:o(()=>[l(A)]),_:1}),i(T(t.id?"编辑":"新增")+"用户 ",1)])]),default:o(()=>[l(U,{ref_key:"formRef",ref:p,model:t,rules:I,size:"default","label-position":"top","status-icon":"","label-width":"100px"},{default:o(()=>[l(u,{label:"姓名",prop:"usrName"},{default:o(()=>[l(c,{modelValue:t.usrName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.usrName=a),modelModifiers:{trim:!0},placeholder:"请输入姓名！",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"usrPhone"},{default:o(()=>[l(c,{type:"number",modelValue:t.usrPhone,"onUpdate:modelValue":e[1]||(e[1]=a=>t.usrPhone=a),placeholder:"请输入手机号！",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"邮箱",prop:"usrMail"},{default:o(()=>[l(c,{modelValue:t.usrMail,"onUpdate:modelValue":e[2]||(e[2]=a=>t.usrMail=a),placeholder:"请输入邮箱！",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"部门",prop:"depID"},{default:o(()=>[l(g,{modelValue:t.depID,"onUpdate:modelValue":e[3]||(e[3]=a=>t.depID=a),placeholder:"-- 请选择 --"},{default:o(()=>[(d(!0),D(N,null,w(v.value,a=>(d(),k(y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"state"},{default:o(()=>[l(g,{modelValue:t.state,"onUpdate:modelValue":e[4]||(e[4]=a=>t.state=a),placeholder:"-- 请选择 --"},{default:o(()=>[(d(),D(N,null,w(x,a=>l(y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(u,{class:"setup"},{default:o(()=>[l(_,{type:"default",onClick:e[5]||(e[5]=a=>H(b).back())},{default:o(()=>[l(r,null,{default:o(()=>[l(B)]),_:1}),i("返 回 ")]),_:1}),l(_,{type:"primary",onClick:e[6]||(e[6]=a=>P(p.value)),loading:m.value},{default:o(()=>[l(r,null,{default:o(()=>[l(R)]),_:1}),i("保 存 ")]),_:1},8,["loading"]),l(_,{type:"warning",onClick:e[7]||(e[7]=a=>M(p.value))},{default:o(()=>[l(r,null,{default:o(()=>[l($)]),_:1}),i("重 置 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})}}});const le=Q(X,[["__scopeId","data-v-c39e859a"]]);export{le as default};
